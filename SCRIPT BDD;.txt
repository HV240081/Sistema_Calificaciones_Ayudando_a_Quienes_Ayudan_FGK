CREATE DATABASE PROYECTO_ES;

USE PROYECTO_ES;

CREATE TABLE ROL (
    ID_ROL INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    ROL VARCHAR(50) NOT NULL
);

CREATE TABLE USUARIO (
    ID_USUARIO INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    NOMBRE VARCHAR(25) NOT NULL,
    APELLIDO VARCHAR(30) NOT NULL,
    CONTRASENA VARCHAR(9) NOT NULL,
    TEMPORAL TINYINT NOT NULL,
    ID_ROL INT NOT NULL,
    FOREIGN KEY (ID_ROL) REFERENCES ROL(ID_ROL)
);

CREATE TABLE PERMISOS (
    ID_PERMISO INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    PERMISO VARCHAR(2) NOT NULL,
    DESCRIPCION VARCHAR(50) NOT NULL
);

INSERT INTO `permisos` (`ID_PERMISO`, `PERMISO`, `DESCRIPCION`) VALUES
(1, 'JU', ''),
(2, 'AD', '')

CREATE TABLE ACTIVIDAD (
    ID_ACTIVIDAD INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    NOM_ACTIVIDAD VARCHAR(30) NOT NULL,
    PORCENTAJE DOUBLE(5,2) NOT NULL,
    DESCRIPCION VARCHAR(60) NOT NULL,
    ID_PERMISO INT NOT NULL,
    FOREIGN KEY (ID_PERMISO) REFERENCES PERMISOS(ID_PERMISO)
);

CREATE TABLE PROYECTO (
    ID_PROYECTO INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    PROYECTO VARCHAR(150) NOT NULL,
    DESCRIPCION VARCHAR(200) NOT NULL
);

CREATE TABLE CALIFICACION (
    ID_CALIFICACION INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    CALIFICACION DOUBLE(5,2) NOT NULL,
    ID_ACTIVIDAD INT NOT NULL,
    ID_PROYECTO INT NOT NULL,
    FOREIGN KEY (ID_PROYECTO) REFERENCES PROYECTO(ID_PROYECTO),
    FOREIGN KEY (ID_ACTIVIDAD) REFERENCES ACTIVIDAD(ID_ACTIVIDAD)
);

CREATE TABLE NOTAS (
    ID_NOTAS INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    COMENTARIOS VARCHAR(200) NOT NULL,
    CALIFICACION DOUBLE(5,2) NOT NULL,
    ID_USUARIO INT NOT NULL,
    ID_PROYECTO INT NOT NULL,
    ID_CALIFICACION INT NOT NULL,
    FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO),
    FOREIGN KEY (ID_PROYECTO) REFERENCES PROYECTO(ID_PROYECTO),
    FOREIGN KEY (ID_CALIFICACION) REFERENCES CALIFICACION(ID_CALIFICACION)
);

CREATE TABLE CRITERIO (
    ID_CRITERIO INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    CRITERIO VARCHAR(50) NOT NULL,
    PORCENTAJE DOUBLE(5,2) NOT NULL,
    DESCRIPCION VARCHAR(100) NOT NULL,
    ID_ACTIVIDAD INT NOT NULL,
    FOREIGN KEY (ID_ACTIVIDAD) REFERENCES ACTIVIDAD(ID_ACTIVIDAD)
);

CREATE TABLE NOTA_CRITERIO (
    ID_NOTACRITERIO INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    NOTA DOUBLE(4,2) NOT NULL,
    ID_CRITERIO INT NOT NULL,
    ID_USUARIO INT NOT NULL,
    FOREIGN KEY (ID_CRITERIO) REFERENCES CRITERIO(ID_CRITERIO),
    FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

CREATE TABLE NOTA_CRITERIO_CALIFICACION (
    ID_NOTA_CRITERIO_CALIFICACION INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    ID_NOTA_CRITERIO INT NOT NULL,
    ID_CALIFICACION INT NOT NULL,
    FOREIGN KEY (ID_NOTA_CRITERIO) REFERENCES NOTA_CRITERIO(ID_NOTACRITERIO),
    FOREIGN KEY (ID_CALIFICACION) REFERENCES CALIFICACION(ID_CALIFICACION)
);

CREATE TABLE NFINAL (
    ID_NFINAL INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    NOTA_FINAL DOUBLE(4,2) NOT NULL,
    ID_PROYECTO INT NOT NULL,
    ID_ACTIVIDAD INT NOT NULL,
    FOREIGN KEY (ID_PROYECTO) REFERENCES PROYECTO(ID_PROYECTO),
    FOREIGN KEY (ID_ACTIVIDAD) REFERENCES ACTIVIDAD(ID_ACTIVIDAD)
);

CREATE TABLE NOTAS_NFINAL (
    ID_NOTAS_NFINAL INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    ID_NOTA INT NOT NULL,
    ID_NFINAL INT NOT NULL,
    FOREIGN KEY (ID_NOTA) REFERENCES NOTAS(ID_NOTAS),
    FOREIGN KEY (ID_NFINAL) REFERENCES NFINAL(ID_NFINAL)
);

CREATE TABLE PREMIO (
    ID_PREMIO INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    PREMIO VARCHAR(50) NOT NULL,
    DESCRIPCION VARCHAR(100) NOT NULL
);

CREATE TABLE PREMIO_NFINAL (
    ID_PREMIO_NFINAL INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    ID_PREMIO INT NOT NULL,
    ID_NFINAL INT NOT NULL,
    FOREIGN KEY (ID_PREMIO) REFERENCES PREMIO(ID_PREMIO),
    FOREIGN KEY (ID_NFINAL) REFERENCES NFINAL(ID_NFINAL)
);

INSERT INTO ROL (ROL) VALUES 
('ADMINISTRADOR'),
('EVALUADOR');
(JURADOPRINCIPAL);

INSERT INTO USUARIO (NOMBRE, APELLIDO, CONTRASENA, TEMPORAL, ID_ROL) VALUES
('Alexis', 'Cisneros', 'proyecto_','1','1'),
('Angie', 'Valencia', 'proyecto_','1','2'),
('Admin', 'Admin', 'proyecto_','1','1');
